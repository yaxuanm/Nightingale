# Nightingale é¡¹ç›®å¯åŠ¨è¯´æ˜ï¼ˆ2024å¹´æ–°ç‰ˆï¼‰

## ğŸµ é¡¹ç›®æ€»è§ˆ

Nightingale æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„è·¨å¹³å°éŸ³é¢‘ç”Ÿæˆå’Œæ··éŸ³å·¥å…·åŒ…ï¼ŒåŒ…å« Web å‰ç«¯ã€React Native ç§»åŠ¨åº”ç”¨å’Œ Python FastAPI åç«¯ã€‚æ”¯æŒå®æ—¶éŸ³é¢‘æ’­æ”¾ã€AI é©±åŠ¨çš„éŸ³é¢‘ç”Ÿæˆï¼ˆä½¿ç”¨ Stability AI Stable Audioï¼‰å’Œåˆ†äº«åŠŸèƒ½ã€‚

### ä¸»è¦åŠŸèƒ½
- å®æ—¶éŸ³é¢‘æ’­æ”¾å’Œæ··éŸ³
- **AI é©±åŠ¨çš„éŸ³é¢‘ç”Ÿæˆï¼ˆé€šè¿‡ Stability AI Stable Audio å®ç°æ–‡æœ¬è½¬éŸ³é¢‘ï¼‰**
- éŸ³é¢‘æ•ˆæœå’Œå¯è§†åŒ–
- å¤šå¹³å°æ”¯æŒï¼šWebã€Nativeï¼ˆReact Nativeï¼‰ã€åç«¯ API
- éŸ³é¢‘å’Œå›¾åƒåˆ†äº«å¯¼å‡º
- ç°ä»£åŒ–å“åº”å¼ UI

### æŠ€æœ¯æ ˆ
- **Web**: React 18, TypeScript, Material-UI, Framer Motion
- **Native**: React Native, Expo, TypeScript
- **åç«¯**: Python 3, FastAPI, Uvicorn, HuggingFace, Google Generative AI, **Stability AI Stable Audio**

### é¡¹ç›®ç»“æ„
```
Nightingale/
â”œâ”€â”€ ambiance-weaver-react/        # Web å‰ç«¯ (React)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/           # UI ç»„ä»¶ (Player, Chat, ç­‰)
â”‚   â”‚   â”œâ”€â”€ utils/                # å·¥å…·å’Œä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ theme/                # ä¸»é¢˜å’Œæ ·å¼
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ ambiance-weaver-native/       # React Native åº”ç”¨ (ç§»åŠ¨ç«¯)
â”‚   â”œâ”€â”€ app/                      # åº”ç”¨å…¥å£å’Œå¯¼èˆª
â”‚   â”‚   â”œâ”€â”€ (tabs)/               # æ ‡ç­¾é¡µ (explore, main, ç­‰)
â”‚   â”‚   â””â”€â”€ _layout.tsx, +not-found.tsx
â”‚   â”œâ”€â”€ components/               # å…±äº«å’Œ UI ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ui/                   # Icon, TabBar, ç­‰
â”‚   â”œâ”€â”€ assets/                   # å›¾ç‰‡ã€å­—ä½“
â”‚   â”œâ”€â”€ hooks/                    # è‡ªå®šä¹‰ hooks
â”‚   â”œâ”€â”€ constants/                # é¢œè‰²å’Œé…ç½®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ screens/              # MainScreen, PlayerScreen, ç­‰
â”‚   â”‚   â””â”€â”€ services/             # AudioService, NotificationService
â”‚   â”œâ”€â”€ ambiance-weaver-native-new/ # (å®éªŒæ€§æ–°ç»“æ„)
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                      # åç«¯ API (Python FastAPI)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py               # ä¸» FastAPI åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ services/             # éŸ³é¢‘ã€å›¾åƒã€AI æœåŠ¡
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”‚   â”œâ”€â”€ scripts/                  # æ‰¹å¤„ç†/æµ‹è¯•/å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”œâ”€â”€ scripts/                      # é¡¹ç›®çº§è„šæœ¬
â””â”€â”€ start_instructions.txt        # å®Œæ•´ç¯å¢ƒå’Œå¯åŠ¨æŒ‡å—
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

> **æ¨èåœ¨ PowerShell ä¸‹è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼**

### 1. ç¯å¢ƒè¦æ±‚

**Python ç‰ˆæœ¬è¦æ±‚**ï¼š
- å¿…é¡»ä½¿ç”¨ **Python 3.11**
- ä¸æ”¯æŒ Python 3.12 æˆ– 3.13ï¼ˆå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼‰

**ç³»ç»Ÿè¦æ±‚**ï¼š
- Windows 10/11
- è‡³å°‘ 8GB RAM
- ç¨³å®šçš„ç½‘ç»œè¿æ¥

### 2. ä¸€é”®ç¯å¢ƒè®¾ç½®ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
```powershell
# åªéœ€è¿è¡Œä¸€æ¬¡ï¼Œè‡ªåŠ¨å®‰è£…åç«¯å’Œå‰ç«¯ä¾èµ–
./start_clean_new.bat
# é€‰æ‹© 5 è®¾ç½®ç¯å¢ƒ
```

### 3. Hugging Face Token è®¾ç½®

**é‡è¦**ï¼šä½¿ç”¨ Stable Audio æœåŠ¡å‰å¿…é¡»å…ˆè®¾ç½® Hugging Face Tokenï¼

#### æ­¥éª¤1ï¼šè·å– Hugging Face Token
1. è®¿é—® https://huggingface.co/settings/tokens
2. ç™»å½•ä½ çš„ Hugging Face è´¦æˆ·
3. ç‚¹å‡» "New token" åˆ›å»ºæ–° token
4. é€‰æ‹© "Read" æƒé™
5. å¤åˆ¶ç”Ÿæˆçš„ token

#### æ­¥éª¤2ï¼šè®¾ç½® Token
```powershell
cd backend
python set_hf_token.py
```
- æŒ‰æç¤ºè¾“å…¥ä½ çš„ Hugging Face token
- è„šæœ¬ä¼šè‡ªåŠ¨éªŒè¯ token æœ‰æ•ˆæ€§
- Token ä¼šä¿å­˜åˆ° `backend/.env` æ–‡ä»¶ä¸­

#### æ­¥éª¤3ï¼šéªŒè¯è®¾ç½®
```powershell
# æ£€æŸ¥ token æ˜¯å¦æ­£ç¡®è®¾ç½®
python -c "import os; from dotenv import load_dotenv; load_dotenv(); print('HF_TOKEN:', 'å·²è®¾ç½®' if os.getenv('HF_TOKEN') else 'æœªè®¾ç½®')"
```

### 4. Stable Audio int32 æº¢å‡ºä¿®å¤

**é‡è¦**ï¼šStable Audio åŒ…åœ¨ Windows ä¸‹å¯èƒ½å›  int32 æº¢å‡ºæŠ¥é”™ã€‚**å¿…é¡»åœ¨ stable_audio è™šæ‹Ÿç¯å¢ƒæ¿€æ´»åè¿è¡Œä¸€æ¬¡ä¿®å¤è„šæœ¬**ï¼š

```powershell
cd backend
.\venv_stableaudio\Scripts\activate
python scripts/stable_audio_fix.py
```

### 5. å¯åŠ¨æœåŠ¡

**ç»Ÿä¸€å…¥å£è„šæœ¬**ï¼š
```powershell
./start_clean_new.bat
```

- é€‰æ‹© 1 å¯åŠ¨ Gemini API æœåŠ¡ï¼ˆç«¯å£ 8000ï¼‰
- é€‰æ‹© 2 å¯åŠ¨ Stable Audio æœåŠ¡ï¼ˆç«¯å£ 8001ï¼‰
- é€‰æ‹© 3 å¯åŠ¨å‰ç«¯ React åº”ç”¨
- é€‰æ‹© 4 ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆæ¨èï¼‰

---

## ğŸ“‹ æœåŠ¡è¯´æ˜

| æœåŠ¡ | ç«¯å£ | åŠŸèƒ½ | å¯åŠ¨æ–¹å¼ |
|------|------|------|----------|
| Gemini API | 8000 | AIæ–‡æœ¬å¤„ç† | `start_clean_new.bat` é€‰ 1/4 |
| Stable Audio | 8001 | AIéŸ³é¢‘ç”Ÿæˆ | `start_clean_new.bat` é€‰ 2/4 |
| React å‰ç«¯ | 3000 | ç”¨æˆ·ç•Œé¢ | `start_clean_new.bat` é€‰ 3/4 |

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡
åœ¨ `ambiance-weaver-react` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# API æœåŠ¡åœ°å€
REACT_APP_GEMINI_API_URL=http://localhost:8000
REACT_APP_STABLE_AUDIO_API_URL=http://localhost:8001
REACT_APP_FRONTEND_URL=http://localhost:3000

# ç¯å¢ƒæ ‡è¯†
REACT_APP_ENV=development
REACT_APP_DEBUG=true
```

### åç«¯ç¯å¢ƒå˜é‡
åœ¨ `backend` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# Hugging Face Tokenï¼ˆå¿…éœ€ï¼‰
HF_TOKEN=your_huggingface_token_here

# API é…ç½®
GEMINI_API_URL=http://localhost:8000
STABLE_AUDIO_API_URL=http://localhost:8001

# å…¶ä»–é…ç½®
DEBUG=true
LOG_LEVEL=INFO
```

### ç¯å¢ƒå˜é‡éªŒè¯
```powershell
# æ£€æŸ¥å‰ç«¯ç¯å¢ƒå˜é‡
cd ambiance-weaver-react
npm start

# æ£€æŸ¥åç«¯ç¯å¢ƒå˜é‡
cd backend
python -c "import os; from dotenv import load_dotenv; load_dotenv(); print('HF_TOKEN:', 'å·²è®¾ç½®' if os.getenv('HF_TOKEN') else 'æœªè®¾ç½®')"
```

---

## ğŸ§ æ‰¹é‡éŸ³é¢‘è¯„æµ‹ç•Œé¢ï¼ˆWeb ä¸€é”®æµ‹è¯•ï¼‰

> æœ¬åŠŸèƒ½æ”¯æŒä¸€é”®æ‰¹é‡ç”Ÿæˆ 5 ä¸ªæµ‹è¯•ç”¨ä¾‹å’ŒéŸ³é¢‘ï¼Œè¿›åº¦æ¡å®æ—¶åé¦ˆï¼Œè¯„æµ‹ç•Œé¢ç®€æ´æ˜äº†ã€‚

### å¯åŠ¨æ–¹å¼
```powershell
cd backend
python scripts/batch_test_web.py
```
- å¯åŠ¨åä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®è¯„æµ‹ç•Œé¢ã€‚
- å¦‚æœªè‡ªåŠ¨æ‰“å¼€ï¼Œå¯æ‰‹åŠ¨è®¿é—®ï¼šhttp://127.0.0.1:8010/

### ä½¿ç”¨è¯´æ˜
1. æ‰“å¼€é¡µé¢åï¼Œç‚¹å‡»"Generate 5 Test Cases"æŒ‰é’®ã€‚
2. ç­‰å¾…è¿›åº¦æ¡å®Œæˆï¼Œè‡ªåŠ¨è¿›å…¥è¯„æµ‹ç•Œé¢ã€‚
3. æ¯ä¸ªéŸ³é¢‘æ˜¾ç¤º promptã€durationã€file sizeã€‚
4. å¯ç›´æ¥åœ¨ç½‘é¡µä¸Šè¿›è¡Œäººå·¥æ‰“åˆ†ï¼Œå¹¶ä¿å­˜ç»“æœã€‚

---

## ğŸ–¼ï¸ é™æ€æ‰¹é‡è¯„æµ‹é¡µé¢ï¼ˆWeb é™æ€æµ‹è¯•ï¼‰

> æœ¬åŠŸèƒ½ç”¨äºåŠ è½½æŒ‡å®šçš„æµ‹è¯•æ•°æ®å’ŒéŸ³é¢‘æ–‡ä»¶ï¼Œè¿›è¡Œé™æ€ç½‘é¡µæ‰¹é‡è¯„æµ‹ï¼Œé€‚åˆå¤ç°å†å²æµ‹è¯•ç»“æœæˆ–è‡ªå®šä¹‰æ•°æ®é›†è¯„æµ‹ã€‚

### å¯åŠ¨æ–¹å¼
```powershell
cd backend
python scripts/fixed_test_web.py --data_file audio_test_output/generated_20250714_145931/web_test_data.json --audio_dir audio_test_output/generated_20250714_145931/audio_files --port 8010
gitpage: https://yaxuanm.github.io/Nightingale/
æ•°æ®ä¿å­˜åœ¨airtable

```
- å¯åŠ¨åä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®é™æ€è¯„æµ‹ç•Œé¢ã€‚
- å¦‚æœªè‡ªåŠ¨æ‰“å¼€ï¼Œå¯æ‰‹åŠ¨è®¿é—®ï¼šhttp://127.0.0.1:8010/

### ä½¿ç”¨è¯´æ˜
1. é¡µé¢ä¼šè‡ªåŠ¨åŠ è½½æŒ‡å®šçš„æµ‹è¯•æ•°æ®å’ŒéŸ³é¢‘æ–‡ä»¶ã€‚
2. å¯ç›´æ¥åœ¨ç½‘é¡µä¸Šè¿›è¡Œäººå·¥æ‰“åˆ†ï¼Œå¹¶ä¿å­˜ç»“æœã€‚
3. é€‚åˆå¤ç°å†å²æ‰¹é‡æµ‹è¯•æˆ–è‡ªå®šä¹‰æ•°æ®é›†è¯„æµ‹ã€‚

---

## ğŸš¨ æ•…éšœæ’é™¤

### 1. Python ç‰ˆæœ¬é—®é¢˜
```powershell
# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version

# å¦‚æœç‰ˆæœ¬ä¸æ˜¯ 3.11ï¼Œè¯·å®‰è£… Python 3.11
# ä¸‹è½½åœ°å€ï¼šhttps://www.python.org/downloads/release/python-3119/
```

### 2. Hugging Face Token é—®é¢˜
```powershell
# é‡æ–°è®¾ç½® token
cd backend
python set_hf_token.py

# æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ
python -c "from huggingface_hub import HfApi; import os; from dotenv import load_dotenv; load_dotenv(); api = HfApi(token=os.getenv('HF_TOKEN')); print('Token æœ‰æ•ˆ' if api.whoami() else 'Token æ— æ•ˆ')"
```

### 3. Stable Audio int32 æº¢å‡ºé—®é¢˜
```powershell
# é‡æ–°è¿è¡Œä¿®å¤è„šæœ¬
cd backend
.\venv_stableaudio\Scripts\activate
python scripts/stable_audio_fix.py
```

### 4. ç¯å¢ƒé—®é¢˜
- é‡æ–°è¿è¡Œ `./start_clean_new.bat` é€‰æ‹© 5 è®¾ç½®ç¯å¢ƒ
- ç¡®ä¿ä½¿ç”¨ Python 3.11

### 5. ä¾èµ–å†²çª
- ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è™šæ‹Ÿç¯å¢ƒ
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨

### 6. æœåŠ¡å¯åŠ¨å¤±è´¥
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®

### 7. æœåŠ¡åˆ‡æ¢é—®é¢˜
- ç¡®ä¿ç›®æ ‡æœåŠ¡å·²å¯åŠ¨
- æ£€æŸ¥å‰ç«¯APIåœ°å€é…ç½®
- éªŒè¯ç«¯å£æ˜¯å¦å¯è®¿é—®

---

## ğŸ“– è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·ä¸ºé”™è¯¯ä¿®å¤ã€æ–°åŠŸèƒ½æˆ–æ–‡æ¡£æ”¹è¿›æäº¤ issue æˆ– pull requestã€‚

## ï¿½ï¿½ è®¸å¯è¯

MIT License 