# **Nightingale - AI个性化音景平台 PRD (V2.5 - 完整版)**

**版本：** 2.5  
**当前状态：** **MVP已开发、部署并完成初步用户测试**  
**最后更新：** 2024年12月

-----

## **1. 简介 (Introduction)**

### **1.1 项目愿景 (Vision)**

Nightingale 旨在成为用户的"**情感与创意声音伴侣**"，通过生成式AI，将用户内心抽象的"意境"（如情感、记忆、灵感）转化为高度个性化、可实时生成的沉浸式音景。

### **1.2 解决的问题 (Problem Statement)**

现有的音频/助眠App无法满足用户日益增长的深度个性化需求，主要存在三大痛点：

* **情感断层 (Emotionally Disconnected):** 预设的音景库无法与用户当下细腻、复杂的情绪产生共鸣。
* **被动消费 (Passive Consumption):** 用户只能作为"消费者"被动选择，无法参与到创作过程中。
* **需求滞后 (On-Demand Gap):** 无法按需生成如ASMR等快速兴起的细分品类声音。

### **1.3 目标用户 (Target Audience)**

* **深度工作者 (Deep Workers):** 需要屏蔽干扰、提升专注力的学生、程序员、研究者。
* **创意探索者 (Creative Explorers):** 需要灵感和"心流"状态的设计师、作家、内容创作者。
* **情绪疗愈者 (Mindful Seekers):** 需要缓解压力、调节情绪、或寻求片刻宁静的都市人群。

-----

## **2. MVP测试结果与核心洞察 (MVP Test Results & Core Insights)**

我们已完成对30组多样化Prompt的小范围用户评测，以下是核心的测试结果与洞察：

### **2.1 核心发现 (Key Quantitative Findings)**

* **整体表现良好但存在波动**: 模型在"**与描述的相关性**"和"**音质**"两个指标上表现最好，平均分均为**3.95/5.0**。
* **放松体验有待提升**: "**放松度**"指标得分最低（平均分3.25），且用户评分的波动性最大（标准差1.36），表明其放松体验的一致性有待提高。
* **优势场景明确**: 模型在"**Mindful模式**"以及"**冥想**"和"**自然**"类别下表现最佳。
* **待改进场景**: "**Focus模式**"和"**音乐**"类别的生成效果得分最低，是后续需要优化的重点。

### **2.2 系统性弱点分析 (Systematic Weakness Analysis)**

评测揭示了模型当前存在的三大系统性弱点：

1. **组合能力不足 (Compositional Prompts)**: 难以处理包含多个声音元素的复杂指令。
2. **语义理解不精 (Semantic Modifiers)**: 对"温柔的"、"轻微的"等修饰词的理解和表达能力有限。
3. **安静声音生成困难 (Low-Amplitude Sounds)**: 在生成低音量或安静声音方面存在挑战。

### **2.3 关键定性洞察 (Key Qualitative Insights)**

* **新场景发现 - ASMR**: 在用户测试中，我们发现ASMR场景是一个极具潜力的新方向，在年轻用户中获得了高度兴趣和正向反馈。这为产品未来的迭代指明了方向。

-----

## **3. 后续迭代建议 (Recommendations for Next Steps)**

基于以上测试结果，为提升产品质量和用户体验，建议后续从以下方面进行改进：

* **优化模型架构**: 采用分层生成等架构来提升对复杂、多元素Prompt的处理能力。
* **改进损失函数**: 调整损失函数以优化对低音量、安静声音的生成效果。
* **完善产品功能**: 引入生成后质量控制，并为用户提供更清晰的Prompt设计引导。

-----

## **4. 当前状态与在线试用 (Current Status & Live Demo)**

* **产品已部署：** Nightingale Web应用的MVP版本已完成云端部署，可供在线试用。
* **用户测试页面：** 用于收集音频质量反馈的静态评测网站也已部署，可公开访问。
    * **链接:** [https://yaxuanm.github.io/Nightingale/](https://www.google.com/search?q=https://yaxuanm.github.io/Nightingale/)

-----

## **5. 核心功能与用户流程 (Core Features & User Flow)**

### **5.1 六种创作模式 (Six Creation Modes)**

#### **1. Deep Focus (专注模式)**
* **目标用户**: 学生、程序员、研究者等需要深度专注的人群
* **核心功能**: 生成清晰、一致、不分散注意力的背景音
* **特色**: 稳态音景，避免突然变化，支持长时间专注工作
* **应用场景**: 学习、编程、研究、写作

#### **2. Creative Flow (创意模式)**
* **目标用户**: 设计师、作家、内容创作者等创意工作者
* **核心功能**: 激发创意灵感和心流状态
* **特色**: 动态音景，富有变化和层次，激发想象力
* **应用场景**: 设计创作、写作、艺术创作、头脑风暴

#### **3. Mindful Escape (冥想模式)**
* **目标用户**: 寻求内心平静和冥想体验的用户
* **核心功能**: 创造宁静、和谐的冥想环境
* **特色**: 平衡和谐的音景，支持冥想和正念练习
* **应用场景**: 冥想、瑜伽、正念练习、情绪调节

#### **4. Sleep (睡眠模式)**
* **目标用户**: 有睡眠困难或希望改善睡眠质量的用户
* **核心功能**: 帮助入睡和保持睡眠状态
* **特色**: 轻柔、催眠的音景，避免刺激性声音
* **应用场景**: 睡前放松、改善睡眠质量、午休

#### **5. Story (故事模式)**
* **目标用户**: 家长、教育工作者、内容创作者
* **核心功能**: 生成带旁白和背景音的故事音景
* **特色**: 结合TTS旁白和环境音，创造沉浸式故事体验
* **应用场景**: 儿童睡前故事、教育内容、创意叙事

#### **6. ASMR (ASMR模式)**
* **目标用户**: ASMR爱好者、寻求放松和刺激的用户
* **核心功能**: 生成触发ASMR反应的声音
* **特色**: 近距离、高细节的触发音，创造亲密听觉体验
* **应用场景**: 放松、减压、ASMR体验、个人护理

### **5.2 MVP核心用户流程**

1. **选择模式 (Onboarding):** 用户首次进入，选择一个初始场景模式（如Focus, Creative, Mindful, Sleep, Story, ASMR）。
2. **输入灵感 (Main Screen):** 用户在主界面输入框中，用自然语言描述自己想要的场景或意境，作为创作的起点。
3. **细化意境 (Chat Screen):** 进入聊天界面后，系统会引导用户进行多轮、分步的选择，以进一步清晰化和丰富他们的"意境"。用户在此处选择具体的氛围 (atmosphere)、情绪 (mood) 和核心声音元素 (elements)。
4. **确认生成 (Generation):** 用户在`ChatScreen`中完成所有选择后，点击生成按钮。系统进入加载状态，后端整合所有输入信息，开始处理请求。
5. **体验与分享 (Player):** 生成完毕后，页面自动跳转至播放器。用户可以收听最终生成的、高度定制化的音频，查看匹配的背景图，并选择下载或分享。

### **5.3 功能用户故事**

#### **Epic 1: 从文本到音景的核心生成体验**

| 用户故事 (User Story) | 验收标准 (Acceptance Criteria) | 模式 |
| :--- | :--- | :--- |
| **作为一名备考学生**，我希望能输入"雨夜的图书馆"，来生成一个能帮我专注的背景音，从而屏蔽宿舍的噪音。 | 1. 用户可在主页输入框输入文本。<br>2. 系统能理解并生成与描述匹配的、清晰且不打扰的音频。<br>3. 音频可循环播放。 | Focus |
| **作为一名ASMR爱好者**，我希望可以描述"轻敲玻璃和翻书的声音"，来生成一段能让我放松的ASMR音景。 | 1. 系统能生成特定、细微的触发音。<br>2. 音效应有近距离、高细节的质感。 | ASMR |
| **作为一名家长**，我希望可以输入一个简单的故事开头，让AI帮我生成一段带旁白和背景音的故事，从而给孩子讲一个独一无二的睡前故事。 | 1. 系统能根据输入生成连贯的旁白。<br>2. 旁白通过TTS合成，并与生成的环境音自动混合。<br>3. 旁白与音景在情感和内容上保持一致。 | Story |
| **作为一名博物馆策展人**，我希望能为一件展品输入它的背景和描述，来生成一段匹配其时代氛围的背景音，从而为游客提供更生动的导览体验。 | 1. 系统能生成符合特定历史、文化背景的氛围音。<br>2. 音频能烘托展品的艺术意境。 | Creative |

#### **Epic 2: 基础的消费与分享能力**

| 用户故事 (User Story) | 验收标准 (Acceptance Criteria) |
| :--- | :--- |
| **作为一名用户**，我希望在一个设计精美的播放器中收听我生成的音频，并能看到与内容匹配的背景图片，从而获得完整的沉浸感。 | 1. 音频生成后，自动进入播放器界面。<br>2. 播放器包含播放/暂停、进度条、音量控制功能。<br>3. AI会根据音频描述生成一张匹配的背景图。 |
| **作为一名用户**，当我生成一个非常满意的音景后，我希望能一键生成分享链接，发给我的朋友，让他们也能听到我的创作。 | 1. 播放器界面提供"分享"按钮。<br>2. 点击后生成一个唯一的URL。<br>3. 其他人打开URL后可以看到同样的背景图并播放音频。 |
| **作为一名用户**，我希望能将喜欢的音频和图片下载到本地，以便离线使用或用于其他创作。 | 1. 播放器界面提供"下载"按钮。<br>2. 点击后可分别或打包下载音频文件和背景图片。 |

-----

## **6. 技术方案与架构 (Technical Architecture)**

### **6.1 技术栈总览**

#### **前端技术栈**
* **框架**: React 18 + TypeScript
* **UI组件库**: Material-UI (MUI) v5.15.11
* **动画**: Framer Motion v11.18.2
* **路由**: React Router DOM v6.22.1
* **构建工具**: Create React App v5.0.1

#### **后端技术栈**
* **框架**: FastAPI v0.116.0
* **服务器**: Uvicorn v0.35.0
* **语言**: Python 3.x
* **音频处理**: Pydub v0.25.1, Soundfile v0.13.1, Librosa v0.11.0
* **数据库**: Supabase v2.16.0

#### **AI模型与服务**
* **文本处理**: Google Gemini (gemini-2.5-flash-lite-preview-06-17, gemini-2.5-flash, gemini-1.5-flash)
* **音频生成**: 
  * Stable Audio Tools v0.0.19 (主要音频生成)
  * MusicGen (音乐生成)
  * AudioGen (环境音生成)
* **文本转语音**: Edge TTS
* **图像生成**: Stability AI (通过API)

#### **深度学习框架**
* **核心**: PyTorch v2.7.1, TorchAudio v2.7.1
* **音频处理**: Transformers v4.53.1
* **音频效果**: Auraloss v0.4.0, TorchLibrosa v0.1.0

### **6.2 系统架构**

#### **服务分离架构**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Gemini API    │    │  Stable Audio   │
│   (React)       │◄──►│   (Port 8000)   │◄──►│   (Port 8001)   │
│   Port 3000     │    │   venv_gemini   │    │ venv_stableaudio│
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       ▼                       │
         │              ┌─────────────────┐             │
         │              │   Queue System  │             │
         │              │  (Async Tasks)  │             │
         │              └─────────────────┘             │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Supabase      │    │   Audio Output  │    │   Image Output  │
│   (Storage)     │    │   (Local/Cloud) │    │   (Local/Cloud) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### **虚拟环境管理**
* **venv_gemini**: 运行Gemini API服务，处理文本分析和提示生成
* **venv_stableaudio**: 运行Stable Audio服务，处理音频生成
* **venv_audio**: 备用音频处理环境

### **6.3 核心API端点**

#### **音频生成相关**
* `POST /api/generate-audio`: 根据描述生成环境音/ASMR/故事音景
* `POST /api/generate-music`: 根据描述生成音乐
* `POST /api/create-story`: 创建带TTS旁白的故事音景
* `POST /api/create-story-music`: 创建带音乐的故事音景

#### **图像生成相关**
* `POST /api/generate-background`: 根据描述生成背景图片

#### **AI对话相关**
* `POST /api/generate-scene`: 分析场景描述，提取声音元素
* `POST /api/generate-options`: 生成选项（氛围、情绪、元素）
* `POST /api/generate-musicgen-options`: 生成音乐选项
* `POST /api/generate-inspiration-chips`: 生成灵感标签

#### **分享功能**
* `POST /api/create-share`: 为生成的内容创建分享链接
* `GET /api/share/{share_id}`: 获取分享链接的具体内容

### **6.4 技术限制 (Technical Limitations)**

#### **音频生成限制**
* **Stable Audio Open Small 模型限制**: 当前使用的 Stable Audio Open Small 模型最大只能生成 **11秒** 的音频片段。为了生成更长的音频，系统采用以下策略：
  * **循环播放**: 将11秒音频片段循环播放以达到目标时长
  * **无缝衔接**: 使用交叉淡入淡出技术确保循环播放时的平滑过渡
  * **质量优化**: 通过音频后处理确保循环播放时的音质一致性

#### **模型能力限制**
* **复杂组合**: 模型在处理包含多个声音元素的复杂指令时存在困难
* **语义理解**: 对"温柔的"、"轻微的"等修饰词的理解和表达能力有限
* **安静声音**: 在生成低音量或安静声音方面存在挑战

#### **系统性能限制**
* **生成时间**: 单次音频生成平均需要10-20秒
* **并发处理**: 当前系统设计为单用户同步处理模式
* **存储限制**: 音频文件存储在本地，需要定期清理

### **6.5 MVP范围之外 (Out of Scope)**

* **高级协同创作:** 与AI的多轮对话式微调、对声音元素的实时可视化调整。
* **移动原生应用 (React Native):** MVP阶段聚焦于Web应用的体验。
* **用户账户系统与社区功能:** 不涉及用户登录、个人主页、作品收藏、社区分享等。

-----

## **7. 部署与运维 (Deployment & Operations)**

### **7.1 环境管理**
* **开发环境**: 本地开发，支持热重载
* **测试环境**: 静态评测网站，用于收集用户反馈
* **生产环境**: 虚拟机部署，支持多用户访问

### **7.2 启动脚本**
* **start_clean_new.bat**: 综合启动脚本，提供菜单选择不同服务
* **start_main_service.bat**: 启动Gemini API服务 (Port 8000)
* **start_gemini_service.ps1**: PowerShell启动脚本
* **start_stable_audio.bat**: 启动Stable Audio服务 (Port 8001)

### **7.3 监控与日志**
* **错误处理**: 完善的异常捕获和用户友好的错误提示
* **性能监控**: 音频生成时间和API响应时间监控

-----

## **8. 未来规划 (Future Roadmap)**

### **8.1 短期目标 (1-3个月)**
* **优化音频质量**: 基于用户测试反馈，改进模型对复杂提示的处理能力
* **增强用户体验**: 完善错误处理和用户友好的提示信息
* **扩展模式支持**: 为每个模式添加更多定制选项

### **8.2 中期目标 (3-6个月)**
* **多模态输入**: 支持语音输入和图片上传作为创作起点
* **高级音频控制**: 添加音量控制、EQ调节、音场设置等功能
* **智能混音**: AI自动混音和音效与故事叙述的标记集成

### **8.3 长期目标 (6-12个月)**
* **移动端应用**: 开发React Native移动应用
* **社区功能**: 用户作品分享、收藏、评论系统
* **高级AI功能**: 更复杂的多轮对话和实时调整

-----

## **9. 附录 (Appendix)**

### **9.1 项目文件结构**
```
Nightingale/
├── ambiance-weaver-react/          # React前端
│   ├── src/
│   │   ├── components/             # 组件
│   │   ├── theme/                  # 主题配置
│   │   └── utils/                  # 工具函数
│   └── public/                     # 静态资源
├── backend/                        # Python后端
│   ├── app/
│   │   ├── services/               # 服务层
│   │   └── main.py                 # 主应用
│   ├── scripts/                    # 脚本文件
│   └── requirements-*.txt          # 依赖文件
└── docs/                          # 文档
```

### **9.2 关键配置文件**
* **package.json**: 前端依赖和脚本配置
* **requirements-stable-audio.txt**: Stable Audio环境依赖
* **requirements-gemini-working.txt**: Gemini环境依赖
* **tsconfig.json**: TypeScript配置
* **eslint.config.js**: 代码规范配置

### **9.3 测试与验证**
* **单元测试**: 核心服务功能测试
* **集成测试**: API端点测试
* **用户测试**: 音频质量评测系统
* **性能测试**: 音频生成性能测试

-----

**文档版本控制**: V2.5 - 基于实际代码实现更新，包含完整的技术架构说明。 