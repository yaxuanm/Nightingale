# Nightingale 固定测试系统

这是一个专门用于用户测试的固定音频样本系统，包含30个预设的音频场景，无需随机生成。

## 系统特点

- **固定30个音频样本**：涵盖自然、城市、天气、冥想、家庭、音乐等6个类别
- **美观的Web界面**：现代化的响应式设计，支持移动设备
- **完整的评价体系**：4个维度的评分 + 详细文字评价
- **一键启动**：自动生成音频并启动测试服务
- **结果导出**：用户评价结果自动保存为JSON文件

## 文件结构

```
backend/scripts/
├── fixed_test_data.py          # 固定30个prompt定义
├── generate_fixed_audio.py     # 音频生成脚本
├── fixed_test_web.py          # Web测试服务
├── start_fixed_test.bat       # 一键启动脚本
└── README_FIXED_TEST.md       # 本说明文档

audio_test_output/fixed_test/
├── audio_files/               # 生成的音频文件
├── evaluations/               # 用户评价结果
├── fixed_prompts.json        # 固定prompt数据
├── fixed_audio_results.json  # 音频生成结果
└── web_test_data.json        # Web测试数据
```

## 快速开始

### 方法1：一键启动（推荐）

```bash
cd backend
scripts/start_fixed_test.bat
```

这个脚本会自动：
1. 生成固定prompt数据
2. 在Stable Audio环境中生成30个音频文件
3. 启动Web测试服务（http://127.0.0.1:8011/）

### 方法2：分步执行

#### 步骤1：生成固定prompt
```bash
cd backend
python scripts/fixed_test_data.py
```

#### 步骤2：生成音频文件
```bash
python scripts/generate_fixed_audio.py
```
选择选项3进行完整流程。

#### 步骤3：启动测试服务
```bash
python scripts/fixed_test_web.py
```

## 30个固定音频场景

### 自然类 (Nature)
1. **清晨森林** - 宁静的森林，鸟鸣和树叶沙沙声
2. **海浪沙滩** - 海浪拍打沙滩，远处海鸥声
3. **山间溪流** - 溪水流过岩石的声音
4. **篝火燃烧** - 木柴燃烧和火星爆裂声
5. **竹林微风** - 微风穿过竹林
6. **草地昆虫** - 蜜蜂嗡嗡和蝴蝶翅膀声
7. **瀑布倾泻** - 瀑布倾泻到深潭
8. **热带雨林** - 异国鸟类和昆虫声
9. **草地小溪** - 草地中的小溪
10. **风吹高草** - 风吹过高草的声音
11. **山中温泉** - 温泉冒泡声

### 城市类 (Urban)
12. **咖啡店** - 咖啡机声和轻柔爵士乐
13. **图书馆** - 翻页声和地毯上的脚步声
14. **火车站** - 广播声和脚步声
15. **城市公园** - 儿童玩耍和鸟鸣
16. **午夜钟楼** - 午夜的钟声
17. **繁忙市场** - 商贩叫卖声
18. **周日教堂** - 周日早晨的教堂钟声

### 天气类 (Weather)
19. **屋顶雨声** - 雨滴落在铁皮屋顶
20. **雷雨交加** - 大雨和闪电
21. **暴风雪** - 风吹过树木
22. **木甲板雨声** - 雨滴落在木甲板

### 冥想类 (Meditation)
23. **禅意花园** - 风铃和流水声
24. **冥想室** - 藏传颂钵声

### 家庭类 (Home)
25. **木屋壁炉** - 壁炉声和外面风声
26. **忙碌厨房** - 锅碗碰撞和食物滋滋声
27. **猫咪暖气** - 猫咪在暖气旁打呼噜
28. **安静书房** - 铅笔在纸上书写声

### 音乐类 (Music)
29. **黑胶唱片** - 黑胶唱片机的声音
30. **摇篮曲** - 轻柔的摇篮曲和哼唱

## 评价维度

用户需要对每个音频从以下4个维度进行评分（1-5分）：

1. **相关性** - 音频内容与描述的相关程度
2. **音频质量** - 音频的技术质量
3. **聆听体验** - 聆听时的享受程度
4. **实用性** - 在实际应用中的可用性

## 测试流程

1. **访问测试页面**：http://127.0.0.1:8011/
2. **聆听音频**：每个音频都有对应的英文描述
3. **填写评价**：为每个音频从4个维度评分并添加详细评价
4. **保存结果**：点击"保存所有评价结果"下载JSON文件

## 结果文件格式

```json
{
  "test_data": [...],           // 测试数据
  "evaluations": {              // 用户评价
    "0": {
      "id": "test_001",
      "prompt": "A peaceful forest...",
      "relevance": "4",
      "quality": "5", 
      "enjoyment": "4",
      "usability": "4",
      "comments": "非常自然的森林声音...",
      "timestamp": "2024-01-01T12:00:00.000Z"
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "total_items": 30,
  "completed_items": 30
}
```

## 部署给其他人测试

### 本地网络部署
1. 修改 `fixed_test_web.py` 中的端口号（避免冲突）
2. 将本机IP地址告诉测试者
3. 测试者访问 `http://你的IP:8011/`

### 公网部署
1. 使用云服务器部署
2. 配置防火墙开放端口
3. 使用域名或IP地址访问

## 故障排除

### 音频文件未生成
- 检查Stable Audio虚拟环境是否正确安装
- 确认API密钥和模型配置
- 查看错误日志

### Web服务无法启动
- 检查端口8011是否被占用
- 确认FastAPI和Uvicorn已安装
- 查看Python环境

### 音频无法播放
- 检查音频文件是否存在
- 确认文件路径正确
- 检查网络连接

## 自定义配置

### 修改音频场景
编辑 `fixed_test_data.py` 中的 `FIXED_PROMPTS` 列表

### 修改Web界面
编辑 `fixed_test_web.py` 中的HTML模板

### 修改评价维度
在HTML模板中修改评分选项

## 联系支持

如有问题，请检查：
1. Python环境配置
2. 虚拟环境安装
3. 依赖包版本
4. 网络连接状态 